"use strict";(self.webpackChunkapache_teaclave_incubating=self.webpackChunkapache_teaclave_incubating||[]).push([[9530],{6583:(n,e,d)=>{d.r(e),d.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"trustzone-sdk-docs/docs/building-rust-ca-as-android-elf","title":"Building Rust CA as Android ELF","description":"In Teaclave TrustZone SDK, example CAs are built as ARM64 Linux ELF by default.","source":"@site/docs/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf.md","sourceDirName":"trustzone-sdk-docs/docs","slug":"/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf","permalink":"/docs/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/incubator-teaclave-website/tree/master/sgx-sdk-api-docs/docs/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf.md","tags":[],"version":"current","frontMatter":{"permalink":"/trustzone-sdk-docs/building-rust-ca-as-android-elf.md"},"sidebar":"tutorialSidebar","previous":{"title":"Teaclave TrustZone SDK Documentation","permalink":"/docs/trustzone-sdk-docs/docs/"},"next":{"title":"Debugging OP-TEE TA","permalink":"/docs/trustzone-sdk-docs/docs/debugging-optee-ta"}}');var s=d(4848),r=d(8453);const o={permalink:"/trustzone-sdk-docs/building-rust-ca-as-android-elf.md"},i="Building Rust CA as Android ELF",l={},a=[];function c(n){const e={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"building-rust-ca-as-android-elf",children:"Building Rust CA as Android ELF"})}),"\n",(0,s.jsx)(e.p,{children:"In Teaclave TrustZone SDK, example CAs are built as ARM64 Linux ELF by default.\nBesides, you can follow these steps to build Rust CAs running on the Android\nplatform:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"Download Android NDK toolchain"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"$ wget https://dl.google.com/android/repository/android-ndk-r21e-linux-x86_64.zip\n$ unzip android-ndk-r21e-linux-x86_64.zip\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:"Add the android target"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"$ rustup target add aarch64-linux-android\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsx)(e.li,{children:"Set toolchains for the target. Add PATH env:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"export PATH=$PATH:/your/path/to/android-ndk-r21e/toolchains/llvm/prebuilt/linux-x86_64/bin/\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"4",children:["\n",(0,s.jsxs)(e.li,{children:["Edit ",(0,s.jsx)(e.code,{children:"incubator-teaclave-trustzone-sdk/.cargo/config"}),", add:"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'[target.aarch64-linux-android]\nlinker = "aarch64-linux-android28-clang"\nar = "aarch64-linux-android-ar"\n'})}),"\n",(0,s.jsxs)(e.ol,{start:"5",children:["\n",(0,s.jsxs)(e.li,{children:["Copy Android libteec.so to\n",(0,s.jsx)(e.code,{children:"/incubator-teaclave-trustzone-sdk/optee/optee_client/out/export/usr/lib"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Note: If you've not built the libteec.so of Android, you can build it using:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"$ cd /path/to/optee/optee_client/\n$ ndk-build APP_BUILD_SCRIPT=./Android.mk NDK_PROJECT_PATH=. NDK_LOG=1 APP_PLATFORM=android-29\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"6",children:["\n",(0,s.jsx)(e.li,{children:"Modify CA's Makefile:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"NAME := hello_world-rs\nTARGET := aarch64-linux-android\nOPTEE_DIR ?= ../../../optee\nOUT_DIR := $(CURDIR)/target/$(TARGET)/release\n\nall: host\n\nhost:\n        @cargo build --target $(TARGET) --release --verbose\nclean:\n        @cargo clean\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"7",children:["\n",(0,s.jsx)(e.li,{children:"build:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"$ make -C examples/hello_world-rs/host\n"})})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},8453:(n,e,d)=>{d.d(e,{R:()=>o,x:()=>i});var t=d(6540);const s={},r=t.createContext(s);function o(n){const e=t.useContext(r);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);