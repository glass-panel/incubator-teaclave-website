"use strict";(self.webpackChunkapache_teaclave_incubating=self.webpackChunkapache_teaclave_incubating||[]).push([[9222],{3283:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"development-tips","title":"Development Tips","description":"RLS/rust-analyzer and IDEs","source":"@site/docs/development-tips.md","sourceDirName":".","slug":"/development-tips","permalink":"/docs/development-tips","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/incubator-teaclave-website/tree/master/sgx-sdk-api-docs/docs/development-tips.md","tags":[],"version":"current","frontMatter":{"permalink":"/docs/development-tips"},"sidebar":"tutorialSidebar","previous":{"title":"Teaclave Worker","permalink":"/docs/codebase/worker"},"next":{"title":"Executing builtin-functions in Occlum","permalink":"/docs/executing-in-occlum"}}');var o=n(4848),s=n(8453);const i={permalink:"/docs/development-tips"},a="Development Tips",l={},c=[{value:"RLS/rust-analyzer and IDEs",id:"rlsrust-analyzer-and-ides",level:2},{value:"Logging",id:"logging",level:2}];function d(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"development-tips",children:"Development Tips"})}),"\n",(0,o.jsx)(r.h2,{id:"rlsrust-analyzer-and-ides",children:"RLS/rust-analyzer and IDEs"}),"\n",(0,o.jsxs)(r.p,{children:["The most common question on developing Teaclave is how to use Rust IDEs to\r\nimprove the development experience, e.g., code completions, type hints and cross\r\nreferences. Internally, these features are supported by either\r\n",(0,o.jsx)(r.a,{href:"https://github.com/rust-lang/rls",children:"RLS"})," or\r\n",(0,o.jsx)(r.a,{href:"https://github.com/rust-analyzer/rust-analyzer",children:"rust-analyzer"}),". Unfortunately,\r\nthese features are not supported in Teaclave's codebase out-of-box.\r\nThe reason is that Teaclave has components targeting different environments (SGX\r\nenclave and Linux app) which need different set of dependencies (SGX crates and\r\nvanilla crates). To support this flexible building and linking process, we are\r\nusing cmake for our ",(0,o.jsx)(r.a,{href:"/docs/build-system",children:"build system"}),". However, there are still\r\nways to workaround and let the analyzer understand the project structures."]}),"\n",(0,o.jsxs)(r.p,{children:["When developing SGX enclaves and corresponding dependent crates, you need to\r\nprepare set of cargo files in the root directory to help the analyzer. This\r\nincludes ",(0,o.jsx)(r.code,{children:"Cargo.toml"})," which can be copied from our build system:\r\n",(0,o.jsx)(r.code,{children:"cmake/tomls/Cargo.sgx_trusted_lib.toml"}),"; ",(0,o.jsx)(r.code,{children:"Cargo.lock"})," which can be copied from\r\n",(0,o.jsx)(r.code,{children:"third_party/crates-sgx/Cargo.lock"}),"; ",(0,o.jsx)(r.code,{children:".cargo/config"})," which can be copied from\r\n",(0,o.jsx)(r.code,{children:"third_party/crates-sgx/config"}),". Similarly, when developing the app parts, you\r\ncan copy the ",(0,o.jsx)(r.code,{children:"cmake/tomls/Cargo.sgx_untrusted_lib.toml"})," file to the root\r\ndirectory as ",(0,o.jsx)(r.code,{children:"Cargo.toml"}),", and ",(0,o.jsx)(r.code,{children:".cargo/config"})," and ",(0,o.jsx)(r.code,{children:"Cargo.lock"})," files can be\r\nfound in ",(0,o.jsx)(r.code,{children:"third_party/crates-io/"})," directory. Besides, please also change the\r\nlast line of ",(0,o.jsx)(r.code,{children:'directory = "vendor"'})," to ",(0,o.jsx)(r.code,{children:'directory = "third_party/crates-sgx/vendor"'})," or ",(0,o.jsx)(r.code,{children:'directory ="third_party/crates-io/vendor"'}),"\r\nso the dependencies can be resolved automatically. For standalone Rust\r\napplications such as CLI, no ",(0,o.jsx)(r.code,{children:"Cargo.toml"})," is needed. After the preparation of\r\n",(0,o.jsx)(r.code,{children:"Cargo.toml"})," in root, RLS/rust-analyzer can understand the projects finally. You\r\nwill see type hints and cross references using IDEs with extensions."]}),"\n",(0,o.jsxs)(r.p,{children:["::: tip NOTE\r\nYou can also simply use the script ",(0,o.jsx)(r.code,{children:"tools/scripts/ide.sh <trusted|untrusted|clean>"}),"\r\nto prepare a IDE-friendly developing environment for trusted\r\npart, untrusetd part, or remove the files generated by this script.\r\n:::"]}),"\n",(0,o.jsx)(r.h2,{id:"logging",children:"Logging"}),"\n",(0,o.jsxs)(r.p,{children:["Teaclave utilizes the ",(0,o.jsx)(r.a,{href:"https://github.com/sebasmagri/env_logger/",children:(0,o.jsx)(r.code,{children:"env_logger"})}),"\r\ncrate to configure the display of ",(0,o.jsx)(r.em,{children:"debug logs"})," via environment variables."]}),"\n",(0,o.jsxs)(r.p,{children:["Logging is controlled via the ",(0,o.jsx)(r.code,{children:"TEACLAVE_LOG"})," environment variables and the value\r\nof this variable is a comma-separated list of logging directives in the\r\n",(0,o.jsx)(r.code,{children:"path::to::module=level"})," form. For example, you can set the environment\r\n",(0,o.jsx)(r.code,{children:"TEACLAVE_LOG=attestation=debug"})," before launching a service to print the debug\r\nlevel (and higher-level) logs in the ",(0,o.jsx)(r.code,{children:"attestation"})," module to stdout/stderr.\r\nThere are five logging levels: ",(0,o.jsx)(r.code,{children:"error"}),", ",(0,o.jsx)(r.code,{children:"warn"}),", ",(0,o.jsx)(r.code,{children:"info"}),", ",(0,o.jsx)(r.code,{children:"debug"})," and ",(0,o.jsx)(r.code,{children:"trace"}),"\r\nwhere error represents the highest-priority log level. Furthermore, you can also\r\nfilter the results with regular expression by simply put ",(0,o.jsx)(r.code,{children:"/"})," followed by a regex\r\nin the directives in the environment variable. You can find more filter usages\r\nin the ",(0,o.jsx)(r.code,{children:"env_logger"}),"'s\r\n",(0,o.jsx)(r.a,{href:"https://docs.rs/env_logger/0.7.1/env_logger/index.html#filtering-results",children:"document"}),"."]}),"\n",(0,o.jsxs)(r.p,{children:["::: tip NOTE\r\nTo prevent sensitive information leakage through logging, for the release build,\r\nwe disable all logging (at build time) lower than the ",(0,o.jsx)(r.code,{children:"info"})," level. That is,\r\nonly ",(0,o.jsx)(r.code,{children:"error"}),", ",(0,o.jsx)(r.code,{children:"warn"})," and ",(0,o.jsx)(r.code,{children:"info"})," logs will be printed.\r\n:::"]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>a});var t=n(6540);const o={},s=t.createContext(o);function i(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);