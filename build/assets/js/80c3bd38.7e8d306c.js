"use strict";(self.webpackChunkapache_teaclave_incubating=self.webpackChunkapache_teaclave_incubating||[]).push([[9530],{6583:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>a});const d=JSON.parse('{"id":"trustzone-sdk-docs/docs/building-rust-ca-as-android-elf","title":"Building Rust CA as Android ELF","description":"In Teaclave TrustZone SDK, example CAs are built as ARM64 Linux ELF by default.","source":"@site/docs/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf.md","sourceDirName":"trustzone-sdk-docs/docs","slug":"/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf","permalink":"/docs/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/incubator-teaclave-website/tree/master/sgx-sdk-api-docs/docs/trustzone-sdk-docs/docs/building-rust-ca-as-android-elf.md","tags":[],"version":"current","frontMatter":{"permalink":"/trustzone-sdk-docs/building-rust-ca-as-android-elf.md"},"sidebar":"tutorialSidebar","previous":{"title":"Teaclave TrustZone SDK Documentation","permalink":"/docs/trustzone-sdk-docs/docs/"},"next":{"title":"Debugging OP-TEE TA","permalink":"/docs/trustzone-sdk-docs/docs/debugging-optee-ta"}}');var t=r(4848),s=r(8453);const o={permalink:"/trustzone-sdk-docs/building-rust-ca-as-android-elf.md"},i="Building Rust CA as Android ELF",l={},a=[];function c(n){const e={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"building-rust-ca-as-android-elf",children:"Building Rust CA as Android ELF"})}),"\n",(0,t.jsx)(e.p,{children:"In Teaclave TrustZone SDK, example CAs are built as ARM64 Linux ELF by default.\r\nBesides, you can follow these steps to build Rust CAs running on the Android\r\nplatform:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Download Android NDK toolchain"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"$ wget https://dl.google.com/android/repository/android-ndk-r21e-linux-x86_64.zip\r\n$ unzip android-ndk-r21e-linux-x86_64.zip\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"2",children:["\n",(0,t.jsx)(e.li,{children:"Add the android target"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"$ rustup target add aarch64-linux-android\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"3",children:["\n",(0,t.jsx)(e.li,{children:"Set toolchains for the target. Add PATH env:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"export PATH=$PATH:/your/path/to/android-ndk-r21e/toolchains/llvm/prebuilt/linux-x86_64/bin/\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"4",children:["\n",(0,t.jsxs)(e.li,{children:["Edit ",(0,t.jsx)(e.code,{children:"incubator-teaclave-trustzone-sdk/.cargo/config"}),", add:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'[target.aarch64-linux-android]\r\nlinker = "aarch64-linux-android28-clang"\r\nar = "aarch64-linux-android-ar"\n'})}),"\n",(0,t.jsxs)(e.ol,{start:"5",children:["\n",(0,t.jsxs)(e.li,{children:["Copy Android libteec.so to\r\n",(0,t.jsx)(e.code,{children:"/incubator-teaclave-trustzone-sdk/optee/optee_client/out/export/usr/lib"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Note: If you've not built the libteec.so of Android, you can build it using:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"$ cd /path/to/optee/optee_client/\r\n$ ndk-build APP_BUILD_SCRIPT=./Android.mk NDK_PROJECT_PATH=. NDK_LOG=1 APP_PLATFORM=android-29\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"6",children:["\n",(0,t.jsx)(e.li,{children:"Modify CA's Makefile:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"NAME := hello_world-rs\r\nTARGET := aarch64-linux-android\r\nOPTEE_DIR ?= ../../../optee\r\nOUT_DIR := $(CURDIR)/target/$(TARGET)/release\r\n\r\nall: host\r\n\r\nhost:\r\n        @cargo build --target $(TARGET) --release --verbose\r\nclean:\r\n        @cargo clean\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"7",children:["\n",(0,t.jsx)(e.li,{children:"build:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"$ make -C examples/hello_world-rs/host\n"})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>i});var d=r(6540);const t={},s=d.createContext(t);function o(n){const e=d.useContext(s);return d.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),d.createElement(s.Provider,{value:e},n.children)}}}]);